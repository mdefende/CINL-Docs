
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.6">
    
    
      
        <title>Structural Pipeline - Civitan International Neuroimaging Laboratory</title>
      
    
    

      <link rel="stylesheet" href="../../../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
<link rel="stylesheet" href="../../../css/lightgallery.min.css" />

    

<script src="../../../js/lightgallery.min.js"></script>

    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#structural-pipeline" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Civitan International Neuroimaging Laboratory" class="md-header__button md-logo" aria-label="Civitan International Neuroimaging Laboratory" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Civitan International Neuroimaging Laboratory
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Structural Pipeline
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/UAB-CINL/UAB-CINL.github.io/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Civitan International Neuroimaging Laboratory" class="md-nav__button md-logo" aria-label="Civitan International Neuroimaging Laboratory" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Civitan International Neuroimaging Laboratory
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/UAB-CINL/UAB-CINL.github.io/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Policies and Procedures
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Policies and Procedures" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Policies and Procedures
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../scanner/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../scanner/onboarding/" class="md-nav__link">
        Onboarding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../scanner/training/" class="md-nav__link">
        Training
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../scanner/scheduling/" class="md-nav__link">
        Scheduling and Billing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../scanner/implants/" class="md-nav__link">
        Screening and Implants
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" type="checkbox" id="__nav_2_6" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_6">
          Data Transfer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Transfer" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          Data Transfer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../scanner/data_management/" class="md-nav__link">
        Local Transfer and OSIRIX
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6_2" type="checkbox" id="__nav_2_6_2" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../scanner/xnat/">XNAT</a>
          
            <label for="__nav_2_6_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="XNAT" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_6_2">
          <span class="md-nav__icon md-icon"></span>
          XNAT
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../scanner/xnat/account/" class="md-nav__link">
        User Registration and Accounts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../scanner/xnat/file_management/" class="md-nav__link">
        File Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../scanner/xnat/projects/" class="md-nav__link">
        XNAT Projects
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Image Preprocessing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Preprocessing" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Image Preprocessing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../bids/">BIDS</a>
          
            <label for="__nav_3_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="BIDS" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          BIDS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bids/principles/" class="md-nav__link">
        Basic BIDS Principles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bids/practical_heudiconv/" class="md-nav__link">
        Practical HeuDiConv Example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bids/heudiconv_scripts/" class="md-nav__link">
        Example Scripts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mriqc/" class="md-nav__link">
        MRIQC
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../fmriprep/">fmriprep</a>
          
            <label for="__nav_3_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="fmriprep" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          fmriprep
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fmriprep/fmriprep-usage/" class="md-nav__link">
        Using fmriprep on Cheaha
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fmriprep/fmriprep-scripts/" class="md-nav__link">
        Example fmriprep Scripts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../qsiprep/">qsiprep</a>
          
            <label for="__nav_3_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="qsiprep" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          qsiprep
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../qsiprep/qsiprep_usage/" class="md-nav__link">
        Using QSIprep on Cheaha
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" checked>
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">HCP Pipelines</a>
          
            <label for="__nav_3_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="HCP Pipelines" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          HCP Pipelines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Structural Pipeline
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Structural Pipeline
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    Modules
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefreesurfer-pipeline" class="md-nav__link">
    PreFreeSurfer Pipeline
  </a>
  
    <nav class="md-nav" aria-label="PreFreeSurfer Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefreesurfer-environment-variables" class="md-nav__link">
    PreFreeSurfer Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefreesurfer-inputs" class="md-nav__link">
    PreFreeSurfer Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefreesurfer-outputs" class="md-nav__link">
    PreFreeSurfer Outputs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#freesurfer-pipeline" class="md-nav__link">
    FreeSurfer Pipeline
  </a>
  
    <nav class="md-nav" aria-label="FreeSurfer Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#freesurfer-environment-variables" class="md-nav__link">
    FreeSurfer Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tkregister" class="md-nav__link">
    tkregister
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freesurfer-inputs" class="md-nav__link">
    FreeSurfer Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freesurfer-outputs" class="md-nav__link">
    FreeSurfer Outputs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postfreesurfer-pipeline" class="md-nav__link">
    PostFreeSurfer Pipeline
  </a>
  
    <nav class="md-nav" aria-label="PostFreeSurfer Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postfreesurfer-environment-variables" class="md-nav__link">
    PostFreeSurfer Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postfreesurfer-inputs" class="md-nav__link">
    PostFreeSurfer Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postfreesurfer-outputs" class="md-nav__link">
    PostFreeSurfer Outputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-surface-glossary" class="md-nav__link">
    Output Surface Glossary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-scripts" class="md-nav__link">
    Example Scripts
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Image Analysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Image Analysis" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Image Analysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Using CIFTI in R
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Using CIFTI in R" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Using CIFTI in R
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../R/cifti-r.html" class="md-nav__link">
        Walkthrough
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../R/cifti-example.html" class="md-nav__link">
        Example Analysis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../resources/" class="md-nav__link">
        Resources
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    Modules
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefreesurfer-pipeline" class="md-nav__link">
    PreFreeSurfer Pipeline
  </a>
  
    <nav class="md-nav" aria-label="PreFreeSurfer Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefreesurfer-environment-variables" class="md-nav__link">
    PreFreeSurfer Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefreesurfer-inputs" class="md-nav__link">
    PreFreeSurfer Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prefreesurfer-outputs" class="md-nav__link">
    PreFreeSurfer Outputs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#freesurfer-pipeline" class="md-nav__link">
    FreeSurfer Pipeline
  </a>
  
    <nav class="md-nav" aria-label="FreeSurfer Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#freesurfer-environment-variables" class="md-nav__link">
    FreeSurfer Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tkregister" class="md-nav__link">
    tkregister
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freesurfer-inputs" class="md-nav__link">
    FreeSurfer Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freesurfer-outputs" class="md-nav__link">
    FreeSurfer Outputs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postfreesurfer-pipeline" class="md-nav__link">
    PostFreeSurfer Pipeline
  </a>
  
    <nav class="md-nav" aria-label="PostFreeSurfer Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postfreesurfer-environment-variables" class="md-nav__link">
    PostFreeSurfer Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postfreesurfer-inputs" class="md-nav__link">
    PostFreeSurfer Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postfreesurfer-outputs" class="md-nav__link">
    PostFreeSurfer Outputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-surface-glossary" class="md-nav__link">
    Output Surface Glossary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-scripts" class="md-nav__link">
    Example Scripts
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/UAB-CINL/UAB-CINL.github.io/edit/master/docs/analysis/hcp_pipelines/structural_pipeline.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="structural-pipeline">Structural Pipeline<a class="headerlink" href="#structural-pipeline" title="Permanent link">&para;</a></h1>
<p>The structural pipeline performs preprocessing for T1w and T2w images and is made up of 3 scripts: the PreFreeSurfer, FreeSurfer, and PostFreeSurfer pipelines which must be run in that specific order. As the names suggest, the structural pipeline is built around FreeSurfer's surface reconstruction. Some minor distortion correction is performed prior to surface reconstruction as well as conversion of surfaces from FreeSurfer space to fs_LR (the standard HCP) space after reconstruction. <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<h3 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link">&para;</a></h3>
<p>First, some external modules are necessary for running these pipelines. The HCP Pipelines take advantage of both FreeSurfer and FSL, but these software packages are not included in the pipeline files. Therefore, you will need to load both of these prior to running the scripts</p>
<!-- markdownlint-disable MD046 -->
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The HCP FAQ currently says that the pipelines do not work with FreeSurfer version 7. You will need to use version 6 that is installed on Cheaha.</p>
</div>
<!-- markdownlint-enable MD046 -->

<p>The following modules have been tested with the structural pipeline, and the commands loading them can be included at the top of your script before running the pipeline:</p>
<div class="highlight"><pre><span></span><code>module load FreeSurfer/6.0.0-centos6_x86_64
module load FSL/6.0.3
<span class="nb">source</span> <span class="si">${</span><span class="nv">FSLDIR</span><span class="si">}</span>/etc/fslconf/fsl.sh
</code></pre></div>
<h4 id="anaconda">Anaconda<a class="headerlink" href="#anaconda" title="Permanent link">&para;</a></h4>
<p>While testing the PreFreeSurfer pipeline, an issue was encountered where the python library <code>numpy</code> was required but not found on the default path. To resolve this issue, create an Anaconda environment with <code>numpy</code> installed. This can be done with the following commands:</p>
<div class="highlight"><pre><span></span><code>module load Anaconda3/2020.11
conda create -n preFS numpy
</code></pre></div>
<p>From here, whenever you run the pipeline, you should load the Anaconda module and then activate the environment using</p>
<div class="highlight"><pre><span></span><code>conda activate preFS
</code></pre></div>
<h2 id="prefreesurfer-pipeline">PreFreeSurfer Pipeline<a class="headerlink" href="#prefreesurfer-pipeline" title="Permanent link">&para;</a></h2>
<p>The shell script for running the PreFS pipeline can be found in the PreFreeSurfer directory in your HCP Pipelines directory. The script is already executable by default, so no permissions should need to be changed in order to run it. Some environment variables will need to be set up prior to executing the pipeline.</p>
<p>This pipeline performs ACPC alignment, readout distortion correction, cross-model registration, and bias field correction (see Figure 9 in <a href="https://pubmed.ncbi.nlm.nih.gov/23668970/">Glasser et al. 2013</a>) of T1w and T2w images. The outputs of these steps are used for surface reconstruction in the FreeSurfer pipeline.</p>
<h3 id="prefreesurfer-environment-variables">PreFreeSurfer Environment Variables<a class="headerlink" href="#prefreesurfer-environment-variables" title="Permanent link">&para;</a></h3>
<p>For all environment variables, set them using the following format:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> &lt;env_var&gt;<span class="o">=</span>&lt;value&gt;
</code></pre></div>
<h4 id="hcppipedir">HCPPIPEDIR<a class="headerlink" href="#hcppipedir" title="Permanent link">&para;</a></h4>
<p><code>HCPPIPEDIR</code> sets the main directory for where you have stored the pipelines. give the full path to the main directory, not just the PreFS directory. An example would look like:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">HCPPIPEDIR</span><span class="o">=</span>/home/mdefende/Scripts/HCPpipelines
</code></pre></div>
<h4 id="hcppipedir_global">HCPPIPEDIR_Global<a class="headerlink" href="#hcppipedir_global" title="Permanent link">&para;</a></h4>
<p>This sets the path to the global scripts used across pipelines. If you set the <code>HCPPIPEDIR</code> variable first, you can just use:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">HCPPIPEDIR_Global</span><span class="o">=</span><span class="si">${</span><span class="nv">HCPPIPEDIR</span><span class="si">}</span>/global/scripts
</code></pre></div>
<h4 id="hcppipedir_templates">HCPPIPEDIR_Templates<a class="headerlink" href="#hcppipedir_templates" title="Permanent link">&para;</a></h4>
<p>This sets the path to the average templates used for converting data to specific spaces. This is also contained in the <code>global</code> directory. Just set it to:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">HCPPIPEDIR_Global</span><span class="o">=</span><span class="si">${</span><span class="nv">HCPPIPEDIR</span><span class="si">}</span>/global/templates
</code></pre></div>
<h4 id="caret7dir">CARET7DIR<a class="headerlink" href="#caret7dir" title="Permanent link">&para;</a></h4>
<p>In addition to the HCP Pipeline directory, another set of scripts is needed to run the pipeline, Caret7. This directory is included with the <a href="https://www.humanconnectome.org/software/get-connectome-workbench">Connectome Workbench</a>. You can either download the CentOS Linux distribution from the linked site and place it in your Cheaha space, or you can direct this variable to one of the installed Workbench modules on Cheaha. The path should end with the <code>bin_rh_linux64</code> directory.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Link directly to the module</span>
<span class="nb">export</span> <span class="nv">CARET7DIR</span><span class="o">=</span>/share/apps/rc/software/ConnectomeWorkbench/1.5.0-rh_linux64/bin_rh_linux64

<span class="c1"># OR download the distribution and link to it directly in your space</span>
<span class="nb">export</span> <span class="nv">CARET7DIR</span><span class="o">=</span>/home/mdefende/Scripts/workbench/bin_rh_linux64
</code></pre></div>
<p>Only one of the above lines is necessary. In the long run, it may be better to download your own copy of the Workbench and keep it as software may be removed from the cluster modules over a long period of time.</p>
<h4 id="spin_echo_method_opt">SPIN_ECHO_METHOD_OPT<a class="headerlink" href="#spin_echo_method_opt" title="Permanent link">&para;</a></h4>
<p>This option sets the method for distortion correction. The default is using the FSL function topup. We can also set the method here, using the default method.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">SPIN_ECHO_METHOD_OPT</span><span class="o">=</span><span class="s2">&quot;TOPUP&quot;</span>
</code></pre></div>
<h3 id="prefreesurfer-inputs">PreFreeSurfer Inputs<a class="headerlink" href="#prefreesurfer-inputs" title="Permanent link">&para;</a></h3>
<p>There are a number of options that can/should be included when running the pipeline. In order to see all of the potential options, open a terminal, set your environment variables, navigate to the PreFreeSurfer directory. You can use the following command to list all of the potential options for the script:</p>
<div class="highlight"><pre><span></span><code>./PreFreeSurfer.sh --help
</code></pre></div>
<p>The PreFS pipeline has a large number of inputs that go along with it. For testing, we tried to be as verbose as possible, so some options may or may not be necessary. Here is a list:</p>
<!-- markdownlint-disable MD046 -->
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some options use either the <code>{x,y,z}</code> triad or the <code>{i,j,k}</code> triad to denote axes in 3D space. <code>{x,y,z}</code> is FSL nomenclature while <code>{i,j,k}</code> is BIDS nomenclature. When testing with BIDS converted data, <code>{i,j,k}</code> gave reasonable outputs. <code>{x,y,z}</code> and non-BIDS data were not tested, so use at your own risk.</p>
</div>
<!-- markdownlint-enable MD046 -->

<p><strong>Main Data:</strong></p>
<ul>
<li><code>--path</code>: the path to the main output directory. The full output path will be path/subject</li>
<li><code>--subject</code>: the name of the subject being processed. The full output path will be path/subject</li>
<li><code>--t1</code>: the path to the input T1w nifti</li>
<li><code>--t2</code>: the path to the input T2w nifti</li>
<li><code>--t1samplespacing</code>: sample spacing for the T1w scan in seconds. (see note under Spin Echo Field Maps)</li>
<li><code>--t2samplespacing</code>: sample spacing for the T2w scan in seconds.</li>
<li><code>--unwarpdir</code>: readout direction of the T1w and T2w images according to the voxel axes. One of <code>{x,y,z,i,j,k,x-,y-,z-,i-,j-, or k-}</code>. The <code>-</code> indicates the negative direction on the specified axis. When testing with T1 and T2 data from the HCP sequences, <code>k</code> gave reasonable outputs.</li>
</ul>
<p><strong>Spin Echo Field Maps:</strong></p>
<ul>
<li><code>--SEPhaseNeg</code>: path to the spin echo field map in the negative phase-encoding direction (AP for data collected on the Anterior-Posterior axis)</li>
<li><code>--SEPhasePos</code>: path to the spin echo field map in the positive phase-encoding direction (PA for data collected on the Anterior-Posterior axis)</li>
<li><code>--seechospacing</code>: effective echo spacing for the spin echo field maps in seconds.</li>
<li><code>--seunwarpdir</code>: phase enconding direction according to the voxel axes for the spin echo field map. Can be either <code>{x,y}</code>, <code>{i,j}</code>, or NONE. <code>{i,j}</code> was used when testing data collected using HCP sequences and gave reasonable outputs.</li>
</ul>
<!-- markdownlint-disable MD046 -->
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The sample spacing values for the T1 and T2 as well as the echo spacing value for the field maps can be found on a detailed scan export. Ask Elizabeth or Eleanor about how to export this from the scanner if your lab does not have one already.</p>
</div>
<!-- markdownlint-enable MD046 -->

<p><strong>Template Options:</strong></p>
<p>These options define the standard atlases used for conversion from native to normalized space. The templates can be found the $HCPPIPEDIR_Templates directory you set previously. Multiple MNI templates at various resolutions are provided.</p>
<ul>
<li><code>--t1template</code>: the T1 template. Can be any resolution.</li>
<li><code>--t1templatebrain</code>: the skull-stripped brain of the template named above. This is included in the template directory</li>
<li><code>--templatemask</code>: the brain mask for the chosen T1 template</li>
<li><code>--t1template2mm</code>: the 2mm MNI template</li>
<li><code>--template2mmmask</code>: brain mask for the 2mm T1 MNI template</li>
<li><code>--t2template</code>: the chosen T2 template.</li>
<li><code>--t2templatebrain</code>: skull stripped brain of the T2 template</li>
<li><code>--t2template2mm</code>: the 2mm T2 template</li>
</ul>
<p><strong>Other Options:</strong></p>
<ul>
<li><code>--avgrdcmethod</code>: set to ${SPIN_ECHO_METHOD_OPT}</li>
<li><code>--topupconfig</code>: path to the topup configuration file. Can be set to ${HCPPIPEDIR}/global/config/b02b0.cnf</li>
<li><code>--fnirtconfig</code>: Config file for the 2mm template used during FNIRT. Can be set to ${HCPPIPEDIR}/global/config/T1_2_MNI152_2mm.cnf</li>
</ul>
<h3 id="prefreesurfer-outputs">PreFreeSurfer Outputs<a class="headerlink" href="#prefreesurfer-outputs" title="Permanent link">&para;</a></h3>
<p>The outputs for the PreFreeSurfer pipeline are divided into 3 directories: <code>MNINonLinear</code>, <code>T1w</code>, and <code>T2w</code>. The files with <code>acpc_dc_restore</code> in the name are the final outputs. Both <code>T1w_acpc_dc_restore</code> and <code>T2w_acpc_dc_restore</code> images are in the <code>T1w</code> directory and should be used as inputs to the FreeSurfer pipeline.</p>
<h2 id="freesurfer-pipeline">FreeSurfer Pipeline<a class="headerlink" href="#freesurfer-pipeline" title="Permanent link">&para;</a></h2>
<p>The main shell script for running the FreeSurfer pipeline can be found in the FreeSurfer directory in your HCP pipelines. The script is already executable by default, so no permissions should need to be changed in order to run it. Some environment variables will need to be set up prior to executing the pipeline.</p>
<p>This script is basically set up to only run the FreeSurfer recon-all command with minor adjustements to take advantage of sub-1mm^3^ voxel sizes, but this step comprises the bulk of the compute time for the structural pipeline.</p>
<h3 id="freesurfer-environment-variables">FreeSurfer Environment Variables<a class="headerlink" href="#freesurfer-environment-variables" title="Permanent link">&para;</a></h3>
<p>The environment variables are much simpler for the FreeSurfer pipeline, only the <code>HCPPIPEDIR</code> and <code>CARET7DIR</code> variables are necessary. Set each of these in the same way you set them in the <a href="./#prefreesurfer-environment-variables">PreFreeSurfer environment section</a>.</p>
<h3 id="tkregister">tkregister<a class="headerlink" href="#tkregister" title="Permanent link">&para;</a></h3>
<p>One alteration will need to be made to the FreeSurferPipeline.sh script before it can be run. It uses an outdated command called <code>tkregister</code> for the last section of the pipeline. This command is packaged with the Freesurfer module, and version 6.0.0 has updated the command name. <code>tkregister</code> no longer exists and will throw an error at the end of the pipeline.</p>
<p>In order to fix this, change the following sections of code (lines 77-79 in HCP pipelines version 4.3.0):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Original</span>
log_Msg <span class="s2">&quot;Showing tkregister version&quot;</span>
which tkregister
tkregister -version
</code></pre></div></td></tr></table></div>
<p>should be changed to:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># New</span>
log_Msg <span class="s2">&quot;Showing tkregister version&quot;</span>
which tkregister2_cmdl
tkregister2_cmdl -version
</code></pre></div></td></tr></table></div>
<p>Additionally, line 781 should be changed from:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">781</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">tkregister_cmd</span><span class="o">=</span><span class="s2">&quot;tkregister&quot;</span>
</code></pre></div></td></tr></table></div>
<p>to</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">781</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">tkregister_cmd</span><span class="o">=</span><span class="s2">&quot;tkregister2_cmdl&quot;</span>
</code></pre></div></td></tr></table></div>
<p>The same change should be made to line 814</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">814</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">tkregister_cmd</span><span class="o">=</span><span class="s2">&quot;tkregister2_cmdl&quot;</span>
</code></pre></div></td></tr></table></div>
<p>After these changes are made, the pipeline should run correctly.</p>
<h3 id="freesurfer-inputs">FreeSurfer Inputs<a class="headerlink" href="#freesurfer-inputs" title="Permanent link">&para;</a></h3>
<p>The FreeSurfer pipeline only has a few necessary arguments to add to the function call and a couple of extra you can add that change the performance of FreeSurfer itself. In order to see all of the potential options, open a terminal, set your environment variables, navigate to the FreeSurfer directory. You can use the following command to list all of the potential options for the script:</p>
<div class="highlight"><pre><span></span><code>./FreeSurfer.sh --help
</code></pre></div>
<h4 id="output-options">Output Options<a class="headerlink" href="#output-options" title="Permanent link">&para;</a></h4>
<ul>
<li><code>--subject-dir</code>: sets the path to the subjects' directory that stores the FreeSurfer outputs.</li>
<li><code>--subject</code>: setting the individual subject's directory name. Should ideally be the same as the name of the subject used during PreFreeSurfer.</li>
</ul>
<!-- markdownlint-disable MD046 -->
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is highly recommended that the <code>--subject-dir</code> is separate from the PreFreeSurfer outputs. FreeSurfer uses a <code>SUBJECTS_DIR</code> environment variable that assumes that all Freesurfer outputs for all subjects in a dataset are contained in that immediate directory. This is not possible if the FreeSurfer outputs are kept in the PreFreeSurfer output directory.</p>
</div>
<!-- markdownlint-enable MD046 -->

<h4 id="input-files">Input Files<a class="headerlink" href="#input-files" title="Permanent link">&para;</a></h4>
<ul>
<li><code>--t1</code>: the full path to the T1w image from the PreFreeSurfer outputs. The input T1 should be <code>T1w_acpc_dc_restore.nii.gz</code></li>
<li><code>--t1brain</code>: the full path to the brain-extracted T1w image from the PreFreeSurfer outputs. Should be <code>T1w_acpc_dc_restore_brain.nii.gz</code></li>
<li><code>--t2</code>: the full path to the T2w image from the PreFreeSurfer outputs. The input T2 should be <code>T2w_acpc_dc_restore.nii.gz</code>. This is found in the <code>T1w</code> directory</li>
</ul>
<h4 id="optional-arguments">Optional Arguments<a class="headerlink" href="#optional-arguments" title="Permanent link">&para;</a></h4>
<ul>
<li><code>--recon-seed</code>: sets the random seed for recon-all surface segmentation</li>
<li><code>--flair</code>: tells recon-all to run with the <code>-FLAIR</code> option instead of the normal <code>-T2</code> option. The FLAIR image should still be input using the <code>--t2</code> option above.</li>
<li><code>--existing-subject</code>: says that the recon has been at least partially performed already. This option should be paired with the <code>--extra-reconall-args</code> option to say which recon stage recon-all should start from.</li>
<li><code>--extra-reconall-args</code>: extra arguments to pass to recon-all. See FreeSurferPipeline.sh's help output for details on how to use this option</li>
</ul>
<h3 id="freesurfer-outputs">FreeSurfer Outputs<a class="headerlink" href="#freesurfer-outputs" title="Permanent link">&para;</a></h3>
<p>FreeSurfer outputs will be stored in the subjects directory set in the pipeline. This directory will contain a folder for each subject ran. These folders contain all of the normal FreeSurfer outputs. More information on this can be found on the <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/ReconAllOutputFiles">FreeSurfer website</a>.</p>
<h2 id="postfreesurfer-pipeline">PostFreeSurfer Pipeline<a class="headerlink" href="#postfreesurfer-pipeline" title="Permanent link">&para;</a></h2>
<p>The final part of the structural pipeline, the PostFreeSurfer pipeline, converts FreeSurfer outputs to native and standard fs_LR meshes of brainordinates and generates the final brain mask, the cortical ribbon volume, and the cortical myelin maps. At the end of the pipeline, all of the major surfaces and volumes are in a standardized CIFTI space viewable on the fs_LR average brain using ConnectomeWorkbench's <code>wb_view</code>.</p>
<p>To create some of the files viewable in <code>wb_view</code>, a ConnectomeWorkbench module will need to be loaded in your script. This can be seen in the example scripts below.</p>
<h3 id="postfreesurfer-environment-variables">PostFreeSurfer Environment Variables<a class="headerlink" href="#postfreesurfer-environment-variables" title="Permanent link">&para;</a></h3>
<p>The <code>HCPPIPEDIR</code>, <code>CARET7DIR</code>, and <code>HCPPIPEDIR_Templates</code> environment variables used in the PreFreeSurfer pipeline are used here again. Be sure to set them to the same locations. In addition, there are a few new variables that need to be set.</p>
<h4 id="hcppipedir_config">HCPPIPEDIR_Config<a class="headerlink" href="#hcppipedir_config" title="Permanent link">&para;</a></h4>
<p>This sets the path to some color tables necessary for converting FreeSurfer annotations. If you set the <code>HCPPIPEDIR</code> variable first, you can just use:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">HCPPIPEDIR_config</span><span class="o">=</span><span class="si">${</span><span class="nv">HCPPIPEDIR</span><span class="si">}</span>/global/config
</code></pre></div>
<h4 id="msmbindir">MSMBINDIR<a class="headerlink" href="#msmbindir" title="Permanent link">&para;</a></h4>
<p>This sets the path to the binaries directory containing the <code>msm</code> command. This is a special folder that is not contained within the main HCP pipelines distribution. Please download the <a href="../scripts/MSM_HOCR-3.0.zip">MSM_HOCR</a> zip file, create a containing folder in your main HCP Pipelines directory, and extract the zip file into that containing folder. Ideally it would look something like <code>.../HCPpipelines/MSM_HOCR/extracted files here...</code>. This variable will then point the to <code>MSM_HOCR</code> folder.</p>
<!-- markdownlint-disable MD046 -->
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This zip file was created from the <a href="https://github.com/ecr05/MSM_HOCR">MSM_HOCR github repo</a>. Use straight from the repo requires some compilation and troubleshooting and is not adequately explained in the instructions. Until a new version is released and required for a new version of the overall pipelines, use the zip file linked above to save time.</p>
</div>
<!-- markdownlint-enable MD046 -->

<h4 id="msmconfigdir">MSMCONFIGDIR<a class="headerlink" href="#msmconfigdir" title="Permanent link">&para;</a></h4>
<p>This sets the path to the configuration directory for MSM. This directory is included with the main distribution of the pipelines and is located at <code>${HCPPIPEDIR}/MSMConfig</code>.</p>
<h3 id="postfreesurfer-inputs">PostFreeSurfer Inputs<a class="headerlink" href="#postfreesurfer-inputs" title="Permanent link">&para;</a></h3>
<p><strong>Required Arguments</strong>:</p>
<ul>
<li><code>--study-folder</code>: the path to the folder containing all subjects' Freesurfer outputs</li>
<li><code>--subject</code>: the subject ID</li>
<li><code>--surfatlasdir</code>: path to the standardized surface templates. Set to <code>${HCPPIPEDIR_templates}/standard_mesh_atlases</code></li>
<li><code>--grayordinatesres</code>: resolution of grayordinates to use, usually 2</li>
<li><code>--grayordinatesdir</code>: set to <code>${HCPPIPEDIR_templates}/&lt;num&gt;_Greyordinates</code>. The value for <code>&lt;num&gt;</code> should be linked <code>--grayordinatesres</code>. For example, if <code>--grayordinatesres</code> was set to 2, set <code>&lt;num&gt;</code> here to <code>91282</code>.</li>
<li><code>--hiresmesh</code>: set to <code>164</code></li>
<li><code>--loresmesh</code>: set to <code>32</code></li>
<li><code>--subcortgraylabels</code>: path to the lookup table containing the subcortical label names and color values. Set to <code>${HCPPIPEDIR_config}/FreeSurferSubcorticalLabelTableLut.txt</code></li>
<li><code>--freesurferlabels</code>: path to the lookup table containing all of the ROI names and color values. Set to <code>${HCPPIPEDIR_config}/FreeSurferAllLut.txt</code></li>
<li><code>--refmyelinmaps</code>: path to the hi-res group reference myelin maps. Set this to <code>${HCPPIPEDIR_templates}/standard_mesh_atlases/Conte69.MyelinMap_BC.164k_fs_LR.dscalar.nii</code>.</li>
</ul>
<p><strong>Optional Arguments</strong>:</p>
<p>For the most part, the default values for the optional arguments will suffice. Do not change these unless you know what you're doing.</p>
<ul>
<li><code>--mcsigma</code>: myelin map bias correction sigma, default is 14.14213562373095048801</li>
<li><code>--regname</code>: surface registration to use, default is MSMSulc</li>
<li><code>--inflatescale</code>: surface inflation scaling factor, default is 1</li>
<li><code>--processing-mode</code>: either HCPStyleData (default) or LegacyStyleData. This can disable some of the preprocessing steps if the acquired data do not meet HCP acquisition guidelines.</li>
<li><code>--structural-qc</code>: set to <code>yes</code> (default) ,<code>no</code>, or <code>only</code>. Whether to run structural qc or not.</li>
</ul>
<h3 id="postfreesurfer-outputs">PostFreeSurfer Outputs<a class="headerlink" href="#postfreesurfer-outputs" title="Permanent link">&para;</a></h3>
<p>Outputs will be somewhat scattered between the subject's <code>T1w</code> and <code>MNINonLinear</code> directories. Basic surface information such as thickness and curvature files are converted to GIFTI format</p>
<h4 id="t1w-directory">T1w Directory<a class="headerlink" href="#t1w-directory" title="Permanent link">&para;</a></h4>
<p>The main additions to this directory are the following:</p>
<ol>
<li><code>fsaverage_LR32k</code>: directory containing the fsaverage surfaces in GIFTI transformed to the fs_LR32k mesh</li>
<li><code>Native</code>: native space participant surfaces in GIFTI format</li>
<li><code>aparc+aseg volumes</code>: FreeSurfer's general parcellation and segmentation volume transformed to native T1w_acpc space. Available in native resolution and 1mm isotropic</li>
<li><code>brainmask</code> and cortical <code>ribbon</code> files</li>
</ol>
<h4 id="mninonlinear">MNINonLinear<a class="headerlink" href="#mninonlinear" title="Permanent link">&para;</a></h4>
<p>Most of the PostFS output surfaces from the T1w directory seem to have been copied to the MNINonLinear directory as well.</p>
<p>All major surfaces and volumes either extracted or derived from Freesurfer outputs have been transferred to the fs_LR 164k mesh and are stored in the top level of the <code>MNINonLinear</code> directory. This includes things like the smoothed and unsmoothed myelin maps. <code>fsaverage_LR32k</code> and <code>Native</code> contain most of the 164k mesh surfaces on the 32k and native meshes, respectively.</p>
<p>The large number of generated surfaces may seem overwhelming, so for visualization, it is suggested to begin using the auto-generated .scene and .spec files. In the main MNINonLinear directory, there will be a file named <code>&lt;sub&gt;.164k_fs_LR.wb.spec</code>. This file can be opened directly using <code>wb_view</code>, part of the <a href="https://www.humanconnectome.org/software/connectome-workbench">Connectome Workbench toolbox</a>. It will load a number of surfaces and volumes for you to view the data for your subject.</p>
<p>Additionally, there is a <code>StructuralQC</code> folder with a file called <code>&lt;sub&gt;.structuralQC.wb_scene</code> you can use to easily load volumes and surfaces for visual inspection. To see the scene file when trying open files, you will need to change the file type filter.</p>
<!-- markdownlint-disable MD046 -->
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently, Cheaha does not have the graphic capabilities to use <code>wb_view</code> in a stable way. Please use your local machine for viewing data. Additionally, the scene and spec files do not contain data themselves as they only point to the volumes and surfaces. The entire participant's output folder including MNINonLinear, T1w, and T2w will need to be downloaded to be able to use these scene and spec files.</p>
</div>
<!-- markdownlint-enable MD046 -->

<h3 id="output-surface-glossary">Output Surface Glossary<a class="headerlink" href="#output-surface-glossary" title="Permanent link">&para;</a></h3>
<p>All of the listed files will be from the 164k mesh, the standard high res output in the MNINonLinear directory. There are a number of different file types (i.e. metric scalar, dtseries, etc.). For more information about the Workbench file types, please read see <a href="https://balsa.wustl.edu/about/fileTypes">https://balsa.wustl.edu/about/fileTypes</a>. Given names here will omit the <code>164k_fs_LR</code> tag for brevity</p>
<h4 id="cifti-files">CIFTI Files<a class="headerlink" href="#cifti-files" title="Permanent link">&para;</a></h4>
<ol>
<li><code>aparc.dlabel.nii</code>: standard FreeSurfer parcellation from the Desikan-Killiany atlas. Contains cortical and subcortical ROIs</li>
<li><code>aparc.a2009s.dlabel.nii</code>: standard FreeSurfer parcellation from the Destrieux atlas. Contains cortical and subcortical ROIs</li>
<li><code>ArealDistortion.dscalar.nii</code>: measure of change of area at each vertex between native and fs_LR spheres after conversion using either MSMSulc or FreeSurfer. See more under the <code>-caret5-method</code> option on <a href="https://www.humanconnectome.org/software/workbench-command/-surface-distortion">wb_command's help page</a></li>
<li><code>corrThickness.dscalar.nii</code>: cortical thickness with effects of curvature regressed out. See <a href="https://www.mail-archive.com/hcp-users@humanconnectome.org/msg03074.html">the HCP Users Archive</a> for more info.</li>
<li><code>curvature.dscalar.nii</code>: curvature</li>
<li><code>EdgeDistortion.dscalar.nii</code>: Instead of taking the ratio of areas, it is instead a scaled log of average edge lengths connected to each vertex. See more under the <code>-edge-method</code> option on <a href="https://www.humanconnectome.org/software/workbench-command/-surface-distortion">wb_command's help page</a></li>
<li><code>MyelinMap.dscalar.nii</code>: estimated myelin fraction measured as the ratio of the T1w image to the T2w image</li>
<li><code>MyelinMap_BC.dscalar.nii</code>: myelin values after bias correction</li>
<li><code>SmoothedMyelinMap.dscalar.nii</code>: myelin values after smoothing (FWHM = 5 according to CreateMyelinMaps.sh in PostFreeSurfer)</li>
<li><code>SmoothedMyelinMap_BC.dscalar.nii</code>: myelin values after smoothing and bias correction</li>
<li><code>StrainJ.dscalar.nii</code></li>
<li><code>StrainR.dscalar.nii</code></li>
<li><code>sulc.dscalar.nii</code>: how deep in a sulcus a vertex is. Measured relative to a midsurface, sulcal vertices are generally positive and gyral vertices are generally negative.</li>
<li><code>thickness.dscalar.nii</code>: raw thickness</li>
</ol>
<h4 id="gifti-data-files">GIFTI Data Files<a class="headerlink" href="#gifti-data-files" title="Permanent link">&para;</a></h4>
<p>Some of the label and shape files here are repeated from the CIFTI files, but only have data from either the left or right cortex with no subcortical data. Left and right hemispheres will be designated in the name of the surface file as <code>L</code> or <code>R</code>.</p>
<ol>
<li><code>aparc.label.gii</code></li>
<li><code>aparc.a2009s.label.gii</code></li>
<li><code>ArealDistortion.shape.gii</code></li>
<li><code>atlasroi.shape.gii</code>: cortical area that is considered outside the medial wall for the standard grayordinate spaces.</li>
<li><code>corrThickness.shape.gii</code></li>
<li><code>curvature.shape.gii</code></li>
<li><code>EdgeDistortion.shape.gii</code></li>
<li><code>MyelinMap.func.gii</code></li>
<li><code>MyelinMap_BC.func.gii</code></li>
<li><code>RefMyelinMap.func.gii</code>: group-average reference myelin map</li>
<li><code>refsulc.shape.gii</code>: template files for MSMSulc registration to fs_LR</li>
<li><code>SmoothedMyelinMap.func.gii</code>: similar to above, except uses a 4 mm FWHM smoothing kernel after the MyelinMap was converted to GIFTI. The data do not come immediately from the CIFTI file</li>
<li><code>SmoothedMyelinMap_BC.func.gii</code>: similar to above, except uses a 4 mm FWHM smoothing kernel after the MyelinMap_BC was converted to GIFTI. The data do not come immediately from the CIFTI file</li>
<li><code>StrainJ.shape.gii</code></li>
<li><code>StrainR.shape.gii</code></li>
<li><code>sulc.shape.gii</code></li>
<li><code>thickness.shape.gii</code></li>
</ol>
<h4 id="gifti-surface-files">GIFTI Surface Files<a class="headerlink" href="#gifti-surface-files" title="Permanent link">&para;</a></h4>
<p>The files listed here contain information about the actual 3D models of the surfaces. These are the file that the GIFTI data files are plotted on top of.</p>
<ol>
<li><code>flat.surf.gii</code></li>
<li><code>inflated.surf.gii</code>: semi-inflated surface make sulcal vertices more visible</li>
<li><code>midthickness.surf.gii</code>: artificial surface designated as halfway between the white matter surface and the pial surface</li>
<li><code>pial.surf.gii</code></li>
<li><code>sphere.surf.gii</code></li>
<li><code>very_inflated.surf.gii</code>: maximally inflated surface</li>
<li><code>white.surf.gii</code></li>
</ol>
<h2 id="example-scripts">Example Scripts<a class="headerlink" href="#example-scripts" title="Permanent link">&para;</a></h2>
<p>Both the single subject script and the array script were tested using data acquired with the HCP sequences and had been converted to BIDS format prior to preprocessing. The array script in particular uses the list of subjects output during BIDS conversion as a list of inputs for the array job. If your data are not BIDS formatted, this method of getting the subject ID and setting the paths to the input data will need to be amended.</p>
<p><strong>PreFreeSurfer:</strong></p>
<ul>
<li><a href="../scripts/PreFreeSurfer_ss_wrapper.sh">Single Subject</a></li>
<li><a href="../scripts/PreFreeSurfer_array_wrapper.sh">Array Job</a></li>
</ul>
<p><strong>FreeSurfer:</strong></p>
<ul>
<li><a href="../scripts/FreeSurfer_ss_wrapper.sh">Single Subject</a></li>
<li><a href="../scripts/FreeSurfer_array_wrapper.sh">Array Job</a></li>
</ul>
<p><strong>PostFreeSurfer:</strong></p>
<ul>
<li><a href="../scripts/PostFreeSurfer_ss_wrapper.sh">Single Subject</a></li>
<li><a href="../scripts/PostFreeSurfer_array_wrapper.sh">Array Job</a></li>
</ul>
<p>For researchers new to running array jobs, please read over the documentation for array jobs at <a href="https://uabrc.github.io/cheaha/slurm/sbatch_usage/#array-jobs">the Cheaha documentation</a>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Thanks to Tori King and Dr. Nina Kraguljac for their contributions towards debugging and running the structural pipeline on Cheaha.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Introduction
            </div>
          </div>
        </a>
      
      
        
        <a href="../../R/cifti-r.html" class="md-footer__link md-footer__link--next" aria-label="Next: Walkthrough" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Walkthrough
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [{"tabs": true}, "navigation.indexes", "toc.follow"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    

      <script src="../../../assets/javascripts/bundle.1514a9a0.min.js"></script>
      
    
<script>
  var elements = document.getElementsByClassName("lightgallery");
  for (var i = 0; i < elements.length; i++) {
    lightGallery(elements[i]);
  }
</script>

  </body>
</html>